version: '3'
services:

# Config Server
  config1:
    image: mongo
    container_name: mongo-config1 
    command: mongod --port 27017 --configsvr --replSet config-rs --bind_ip_all
    volumes:
      - ./scripts:/scripts 
    ports:
      - 27100:27017
    restart: always
    networks:
      - mongo
  config2:
    image: mongo
    container_name: mongo-config2
    command: mongod --port 27017 --configsvr --replSet config-rs --bind_ip_all
    volumes:
      - ./scripts:/scripts 
    ports:
      - 27101:27017
    restart: always
    networks:
      - mongo
  config3:
    image: mongo
    container_name: mongo-config3
    command: mongod --port 27017 --configsvr --replSet config-rs --bind_ip_all
    volumes:
      - ./scripts:/scripts 
    ports:
      - 27102:27017
    restart: always
    networks:
      - mongo

# Mongos
  mongos1:
    image: mongo
    container_name: mongos1
    command: mongos --port 27017 --configdb config-rs/config1:27017,config2:27017,config3:27017 --bind_ip_all
    ports:
      - 27110:27017
    restart: always
    volumes:
      - ./scripts:/scripts
    networks:
      - mongo
  mongos2:
    image: mongo
    container_name: mongos2
    command: mongos --port 27017 --configdb config-rs/config1:27017,config2:27017,config3:27017 --bind_ip_all
    ports:
      - 27111:27017
    restart: always
    volumes:
      - ./scripts:/scripts
    networks:
      - mongo
  mongos3:
    image: mongo
    container_name: mongos3
    command: mongos --port 27017 --configdb config-rs/config1:27017,config2:27017,config3:27017 --bind_ip_all
    ports:
      - 27112:27017
    restart: always
    volumes:
      - ./scripts:/scripts
    networks:
      - mongo

# Shards
  # Shards 1
  shard1-1:
    image: mongo
    container_name: mongo-shard1-1
    command: mongod --port 27017 --shardsvr --replSet shard-rs-1 --bind_ip_all
    volumes:
      - ./scripts:/scripts
    ports:
      - 27120:27017
    restart: always
    networks:
      - mongo
  shard1-2:
    image: mongo
    container_name: mongo-shard1-2
    command: mongod --port 27017 --shardsvr --replSet shard-rs-1 --bind_ip_all
    volumes:
      - ./scripts:/scripts
    ports:
      - 27121:27017
    restart: always
    networks:
      - mongo
  shard1-3:
    image: mongo
    container_name: mongo-shard1-3
    command: mongod --port 27017 --shardsvr --replSet shard-rs-1 --bind_ip_all
    volumes:
      - ./scripts:/scripts
    ports:
      - 27122:27017
    restart: always
    networks:
      - mongo

  # Shards 2
  shard2-1:
    image: mongo
    container_name: mongo-shard2-1
    command: mongod --port 27017 --shardsvr --replSet shard-rs-2 --bind_ip_all
    volumes:
      - ./scripts:/scripts
    ports:
      - 27123:27017
    restart: always
    networks:
      - mongo
  shard2-2:
    image: mongo
    container_name: mongo-shard2-2
    command: mongod --port 27017 --shardsvr --replSet shard-rs-2 --bind_ip_all
    volumes:
      - ./scripts:/scripts
    ports:
      - 27124:27017
    restart: always
    networks:
      - mongo
  shard2-3:
    image: mongo
    container_name: mongo-shard2-3
    command: mongod --port 27017 --shardsvr --replSet shard-rs-2 --bind_ip_all
    volumes:
      - ./scripts:/scripts
    ports:
      - 27125:27017
    restart: always
    networks:
      - mongo

  # Shards 3
  shard3-1:
    image: mongo
    container_name: mongo-shard3-1
    command: mongod --port 27017 --shardsvr --replSet shard-rs-3 --bind_ip_all
    volumes:
      - ./scripts:/scripts
    ports:
      - 27126:27017
    restart: always
    networks:
      - mongo
  shard3-2:
    image: mongo
    container_name: mongo-shard3-2
    command: mongod --port 27017 --shardsvr --replSet shard-rs-3 --bind_ip_all
    volumes:
      - ./scripts:/scripts
    ports:
      - 27127:27017
    restart: always
    networks:
      - mongo
  shard3-3:
    image: mongo
    container_name: mongo-shard3-3
    command: mongod --port 27017 --shardsvr --replSet shard-rs-3 --bind_ip_all
    volumes:
      - ./scripts:/scripts
    ports:
      - 27128:27017
    restart: always
    networks:
      - mongo

networks:
  mongo:
